<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${pageTitle}">My Appointments</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

<!-- Navbar -->
<nav class="bg-white shadow-md sticky top-0 z-10">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <a href="/" class="text-xl font-bold text-indigo-600 flex items-center gap-2">
      <i class="fas fa-heartbeat"></i> MediCare
    </a>

    <div class="flex items-center gap-8 flex-wrap">
      <a href="/patients/profile"
         class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 font-medium transition">
        <i class="fas fa-user"></i> My Profile
      </a>

      <a href="/doctors"
         class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 font-medium transition">
        <i class="fas fa-search"></i> Find Doctors
      </a>

      <a th:href="@{/auth/logout}"
         class="flex items-center gap-2 text-red-600 hover:text-red-700 font-medium transition">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>
</nav>

<div class="max-w-6xl mx-auto p-6 mt-8">
  <h1 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
    <i class="fas fa-calendar-alt mr-3 text-indigo-600"></i>
    My Appointments
  </h1>

  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full table-auto">
        <thead class="bg-indigo-600 text-white">
        <tr>
          <th class="px-6 py-4 text-left">Date</th>
          <th class="px-6 py-4 text-left">Time</th>
          <th class="px-6 py-4 text-left">Doctor</th>
          <th class="px-6 py-4 text-left">Speciality</th>
          <th class="px-6 py-4 text-left">Fee</th>
          <th class="px-6 py-4 text-center">Status</th>
          <th class="px-6 py-4 text-center">Actions</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
        <tr th:each="appt : ${appointments}" class="hover:bg-indigo-50 transition">
          <td class="px-6 py-4">
            <span th:text="${#temporals.format(appt.appointmentDate, 'dd MMM yyyy')}">
              15 Dec 2025
            </span>
            <span class="text-sm text-green-600 font-medium block"
                  th:if="${#temporals.day(appt.appointmentDate) == #temporals.day(#temporals.createNow())}">
              (Today)
            </span>
            <span class="text-sm text-blue-600 font-medium block"
                  th:if="${appt.appointmentDate.isAfter(#temporals.createNow().toLocalDate())}">
              (Upcoming)
            </span>
            <span class="text-sm text-gray-500 font-medium block"
                  th:if="${appt.appointmentDate.isBefore(#temporals.createNow().toLocalDate())}">
              (Past)
            </span>
          </td>
          <td class="px-6 py-4">
            <span th:text="${appt.appointmentTime}">10:00 AM</span>
          </td>
          <td class="px-6 py-4">
            <div class="flex items-center">
              <i class="fas fa-user-md text-indigo-600 mr-2"></i>
              <span th:text="${appt.doctor.doctorName}">Dr. John Doe</span>
            </div>
          </td>
          <td class="px-6 py-4">
            <span class="text-indigo-600 font-medium" th:text="${appt.doctor.speciality}">Cardiology</span>
          </td>
          <td class="px-6 py-4">
            ৳<span th:text="${appt.doctor.consultationFee}">1200</span>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="px-3 py-1 rounded-full text-xs font-medium"
                  th:classappend="${appt.status.name() == 'CONFIRMED' ? 'bg-green-100 text-green-800' :
                                   appt.status.name() == 'CANCELLED' ? 'bg-red-100 text-red-800' :
                                   'bg-gray-100 text-gray-800'}"
                  th:text="${appt.status.name()}">CONFIRMED</span>
          </td>
          <td class="px-6 py-4 text-center space-y-2">

            <!-- ========== CONFIRMED Appointment (No Prescription) ========== -->
            <th:block th:if="${appt.status.name() == 'CONFIRMED' and appt.prescription == null}">
              <!-- View Doctor Profile -->
              <a th:href="@{'/doctors/' + ${appt.doctor.id} + '/profile'}"
                 class="block text-indigo-600 hover:underline text-sm font-medium">
                <i class="fas fa-user-md mr-1"></i> View Doctor
              </a>

              <!-- Prescription Available After Visit -->
              <div class="mt-2 text-blue-600 text-sm">
                <i class="fas fa-hourglass-half mr-2"></i> Prescription available after visit
              </div>

              <!-- Cancel Button -->
              <button th:onclick="'cancelAppointment(' + ${appt.id} + ')'"
                      class="block w-full text-red-600 hover:text-red-800 text-sm font-medium mt-2">
                <i class="fas fa-times-circle mr-1"></i> Cancel Appointment
              </button>
            </th:block>

            <!-- ========== CONFIRMED Appointment (With Prescription) ========== -->
            <th:block th:if="${appt.status.name() == 'CONFIRMED' and appt.prescription != null}">
              <!-- View Doctor Profile -->
              <a th:href="@{'/doctors/' + ${appt.doctor.id} + '/profile'}"
                 class="block text-indigo-600 hover:underline text-sm font-medium">
                <i class="fas fa-user-md mr-1"></i> View Doctor
              </a>

              <!-- Review Doctor Button -->
              <button th:onclick="'openReviewModal(this);'"
                      th:attr="data-appointment-id=${appt.id}, data-doctor-name=${appt.doctor.doctorName}"
                      class="block w-full text-yellow-600 hover:text-yellow-800 text-sm font-medium mt-2 cursor-pointer">
                <i class="fas fa-star mr-1"></i> Review Doctor
              </button>

              <!-- View Prescription -->
              <a th:href="@{'/patients/prescriptions/' + ${appt.id}}"
                 class="inline-block bg-green-600 text-white px-5 py-2.5 rounded-lg hover:bg-green-700 text-sm font-medium transition shadow mt-2">
                <i class="fas fa-file-prescription mr-2"></i> View Prescription
              </a>
            </th:block>

            <!-- ========== CANCELLED Appointment ========== -->
            <th:block th:if="${appt.status.name() == 'CANCELLED'}">
              <!-- View Doctor Profile -->
              <a th:href="@{'/doctors/' + ${appt.doctor.id} + '/profile'}"
                 class="block text-indigo-600 hover:underline text-sm font-medium">
                <i class="fas fa-user-md mr-1"></i> View Doctor
              </a>

              <!-- Appointment Cancelled Message -->
              <div class="mt-2 text-red-600 text-sm font-medium">
                <i class="fas fa-ban mr-2"></i> Appointment Cancelled
              </div>
            </th:block>

          </td>
        </tr>

        <!-- Empty state -->
        <tr th:if="${appointments == null or #lists.isEmpty(appointments)}">
          <td colspan="7" class="px-6 py-12 text-center text-gray-500">
            <i class="fas fa-calendar-times text-4xl mb-4 text-gray-300"></i>
            <p class="text-lg">No appointments booked yet.</p>
            <a href="/doctors" class="mt-4 inline-block bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">
              Find Doctors & Book Now
            </a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Review Modal -->
<div id="reviewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Rate Your Experience</h3>

      <div class="flex justify-end mb-4">
        <button onclick="closeReviewModal()" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>

      <form id="reviewForm" th:action="@{/patients/reviews}" method="post" class="space-y-4">
        <input type="hidden" name="appointmentId" id="appointmentId" value="">

        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-sm font-medium text-blue-800" id="doctorName">Reviewing: Dr. Smith</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Your Rating (1-5 Stars)</label>
          <div class="flex justify-center space-x-1" id="stars">
            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="1"></i>
            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="2"></i>
            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="3"></i>
            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="4"></i>
            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="5"></i>
          </div>
          <input type="hidden" name="rating" id="ratingInput" value="0">
          <p class="text-xs text-gray-500 mt-1 text-center">Click a star to select</p>
        </div>

        <div>
          <label for="comment" class="block text-sm font-medium text-gray-700 mb-2">Comments (Optional)</label>
          <textarea id="comment" name="comment" rows="4"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Share what you liked or any suggestions..."></textarea>
        </div>

        <div class="flex justify-end space-x-2">
          <button type="button" onclick="closeReviewModal()"
                  class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
            Cancel
          </button>
          <button type="submit" id="submitBtn" disabled
                  class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50">
            Submit Review
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  function openReviewModal(button) {
    const appointmentId = button.getAttribute('data-appointment-id');
    const doctorName = button.getAttribute('data-doctor-name');

    if (!appointmentId || !doctorName) {
      alert('Error loading review data');
      return;
    }

    document.getElementById('appointmentId').value = appointmentId;
    document.getElementById('doctorName').textContent = 'Reviewing: ' + doctorName;
    document.getElementById('ratingInput').value = '0';
    document.getElementById('comment').value = '';
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('reviewModal').classList.remove('hidden');

    // Reset stars
    const stars = document.querySelectorAll('#stars i');
    stars.forEach(star => {
      star.classList.remove('text-yellow-500');
      star.classList.add('text-gray-400');
    });
  }

  function closeReviewModal() {
    document.getElementById('reviewModal').classList.add('hidden');
  }

  function highlightStars(rating, stars) {
    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.remove('text-gray-400');
        star.classList.add('text-yellow-500');
      } else {
        star.classList.remove('text-yellow-500');
        star.classList.add('text-gray-400');
      }
    });
  }

  function cancelAppointment(appointmentId) {
    if (!confirm('Are you sure you want to cancel this appointment?')) {
      return;
    }

    fetch(`/patients/appointments/${appointmentId}/cancel`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('Appointment cancelled successfully');
        location.reload();
      } else {
        alert('Error: ' + (data.error || 'Failed to cancel'));
      }
    })
    .catch(error => {
      alert('Error cancelling appointment');
      console.error(error);
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('#stars i');
    const ratingInput = document.getElementById('ratingInput');
    const submitBtn = document.getElementById('submitBtn');
    const reviewForm = document.getElementById('reviewForm');
    const starsContainer = document.getElementById('stars');

    stars.forEach(star => {
      star.addEventListener('click', function() {
        const rating = parseInt(this.getAttribute('data-rating'));
        ratingInput.value = rating;
        highlightStars(rating, stars);
        submitBtn.disabled = false;
      });

      star.addEventListener('mouseover', function() {
        const rating = parseInt(this.getAttribute('data-rating'));
        highlightStars(rating, stars);
      });
    });

    starsContainer.addEventListener('mouseleave', function() {
      const currentRating = parseInt(ratingInput.value);
      highlightStars(currentRating, stars);
    });

    reviewForm.addEventListener('submit', function(e) {
      e.preventDefault();
      if (ratingInput.value === '0') {
        alert('Please select a rating!');
        return;
      }

      const formData = new FormData();
      formData.append('appointmentId', document.getElementById('appointmentId').value);
      formData.append('rating', ratingInput.value);
      formData.append('comment', document.getElementById('comment').value);

      fetch('/patients/reviews', { method: 'POST', body: formData })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Review submitted! Thanks for your feedback.');
          closeReviewModal();
          location.reload();
        } else {
          alert('Error: ' + (data.error || 'Submit failed'));
        }
      })
      .catch(error => {
        alert('Submission error');
        console.error(error);
      });
    });
  });
</script>

</body>
</html>



























<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title th:text="${pageTitle}">My Appointments</title>-->
<!--  <script src="https://cdn.tailwindcss.com"></script>-->
<!--  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">-->
<!--</head>-->
<!--<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">-->

<!--&lt;!&ndash; Navbar &ndash;&gt;-->
<!--<nav class="bg-white shadow-md sticky top-0 z-10">-->
<!--  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">-->
<!--    &lt;!&ndash; Logo &ndash;&gt;-->
<!--    <a href="/" class="text-xl font-bold text-indigo-600 flex items-center gap-2">-->
<!--      <i class="fas fa-heartbeat"></i> MediCare-->
<!--    </a>-->

<!--    &lt;!&ndash; Navigation Links (No box/button style, full consistency with icon + text) &ndash;&gt;-->
<!--    <div class="flex items-center gap-8 flex-wrap">-->
<!--      &lt;!&ndash; My Profile &ndash;&gt;-->
<!--      <a href="/patients/profile"-->
<!--         class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 font-medium transition">-->
<!--        <i class="fas fa-user"></i> My Profile-->
<!--      </a>-->

<!--      &lt;!&ndash; Find Doctors &ndash;&gt;-->
<!--      <a href="/doctors"-->
<!--         class="flex items-center gap-2 text-gray-700 hover:text-indigo-600 font-medium transition">-->
<!--        <i class="fas fa-search"></i> Find Doctors-->
<!--      </a>-->

<!--      &lt;!&ndash; Logout &ndash;&gt;-->
<!--      <a th:href="@{/auth/logout}"-->
<!--         class="flex items-center gap-2 text-red-600 hover:text-red-700 font-medium transition">-->
<!--        <i class="fas fa-sign-out-alt"></i> Logout-->
<!--      </a>-->
<!--    </div>-->
<!--  </div>-->
<!--</nav>-->

<!--<div class="max-w-6xl mx-auto p-6 mt-8">-->
<!--  <h1 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">-->
<!--    <i class="fas fa-calendar-alt mr-3 text-indigo-600"></i>-->
<!--    My Appointments-->
<!--  </h1>-->

<!--  <div class="bg-white rounded-xl shadow-lg overflow-hidden">-->
<!--    <div class="overflow-x-auto">-->
<!--      <table class="w-full table-auto">-->
<!--        <thead class="bg-indigo-600 text-white">-->
<!--        <tr>-->
<!--          <th class="px-6 py-4 text-left">Date</th>-->
<!--          <th class="px-6 py-4 text-left">Time</th>-->
<!--          <th class="px-6 py-4 text-left">Doctor</th>-->
<!--          <th class="px-6 py-4 text-left">Speciality</th>-->
<!--          <th class="px-6 py-4 text-left">Fee</th>-->
<!--          <th class="px-6 py-4 text-center">Status</th>-->
<!--          <th class="px-6 py-4 text-center">Actions</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody class="divide-y divide-gray-200">-->
<!--        <tr th:each="appt : ${appointments}" class="hover:bg-indigo-50 transition">-->
<!--          <td class="px-6 py-4">-->
<!--            <span th:text="${#temporals.format(appt.appointmentDate, 'dd MMM yyyy')}">-->
<!--              15 Dec 2025-->
<!--            </span>-->
<!--            <span class="text-sm text-green-600 font-medium block"-->
<!--                  th:if="${#temporals.day(appt.appointmentDate) == #temporals.day(#temporals.createNow())}">-->
<!--              (Today)-->
<!--            </span>-->
<!--            <span class="text-sm text-blue-600 font-medium block"-->
<!--                  th:if="${appt.appointmentDate.isAfter(#temporals.createNow().toLocalDate())}">-->
<!--              (Upcoming)-->
<!--            </span>-->
<!--            <span class="text-sm text-gray-500 font-medium block"-->
<!--                  th:if="${appt.appointmentDate.isBefore(#temporals.createNow().toLocalDate())}">-->
<!--              (Past)-->
<!--            </span>-->
<!--          </td>-->
<!--          <td class="px-6 py-4">-->
<!--            <span th:text="${appt.appointmentTime}">10:00 AM</span>-->
<!--          </td>-->
<!--          <td class="px-6 py-4">-->
<!--            <div class="flex items-center">-->
<!--              <i class="fas fa-user-md text-indigo-600 mr-2"></i>-->
<!--              <span th:text="${appt.doctor.doctorName}">Dr. John Doe</span>-->
<!--            </div>-->
<!--          </td>-->
<!--          <td class="px-6 py-4">-->
<!--            <span class="text-indigo-600 font-medium" th:text="${appt.doctor.speciality}">Cardiology</span>-->
<!--          </td>-->
<!--          <td class="px-6 py-4">-->
<!--            ৳<span th:text="${appt.doctor.consultationFee}">1200</span>-->
<!--          </td>-->
<!--          <td class="px-6 py-4 text-center">-->
<!--            <span class="px-3 py-1 rounded-full text-xs font-medium"-->
<!--                  th:classappend="${appt.status.name() == 'CONFIRMED' ? 'bg-green-100 text-green-800' :-->
<!--                                   appt.status.name() == 'CANCELLED' ? 'bg-red-100 text-red-800' :-->
<!--                                   'bg-gray-100 text-gray-800'}"-->
<!--                  th:text="${appt.status.name()}">CONFIRMED</span>-->
<!--          </td>-->
<!--          <td class="px-6 py-4 text-center space-y-2">-->
<!--            &lt;!&ndash; View Doctor Profile &ndash;&gt;-->
<!--            <a th:href="@{'/doctors/' + ${appt.doctor.id} + '/profile'}"-->
<!--               class="block text-indigo-600 hover:underline text-sm font-medium">-->
<!--              <i class="fas fa-user-md mr-1"></i> View Doctor-->
<!--            </a>-->

<!--            &lt;!&ndash; Cancel Button (for CONFIRMED only) &ndash;&gt;-->
<!--            <button th:if="${appt.status  == 'CONFIRMED'}"-->
<!--                    th:onclick="'cancelAppointment(' + ${appt.id} + ')'"-->
<!--                    class="block w-full text-red-600 hover:text-red-800 text-sm font-medium mt-2">-->
<!--              <i class="fas fa-times-circle mr-1"></i> Cancel-->
<!--            </button>-->

<!--            <button th:if="${appt.prescription != null}"-->
<!--                    th:onclick="'openReviewModal(this);'"-->
<!--                    th:data-appointment-id="${appt.id}"-->
<!--                    th:data-doctor-name="${appt.doctor.doctorName}"-->
<!--                    class="block w-full text-yellow-600 hover:text-yellow-800 text-sm font-medium mt-2 cursor-pointer">-->
<!--              <i class="fas fa-star mr-1"></i> Review Doctor-->
<!--            </button>-->

<!--            &lt;!&ndash; Prescription View (if exists) &ndash;&gt;-->
<!--            <div th:if="${appt?.prescription != null}" class="mt-3">-->
<!--              <a th:href="@{'/patients/prescriptions/' + ${appt.id}}"-->
<!--                 class="inline-block bg-green-600 text-white px-5 py-2.5 rounded-lg hover:bg-green-700 text-sm font-medium transition shadow">-->
<!--                <i class="fas fa-file-prescription mr-2"></i> View Prescription-->
<!--              </a>-->
<!--            </div>-->

<!--            &lt;!&ndash; No prescription yet (for past or today) &ndash;&gt;-->
<!--            <div th:if="${appt?.prescription == null-->
<!--                          and appt.appointmentDate.isBefore(#temporals.createNow().toLocalDate().plusDays(1))}"-->
<!--                 class="mt-3 text-gray-500 text-sm">-->
<!--              <i class="fas fa-clock mr-2"></i> No prescription yet-->
<!--            </div>-->

<!--            &lt;!&ndash; Upcoming appointment message &ndash;&gt;-->
<!--            <div th:if="${appt.appointmentDate.isAfter(#temporals.createNow().toLocalDate())}"-->
<!--                 class="mt-3 text-blue-600 text-sm">-->
<!--              <i class="fas fa-hourglass-half mr-2"></i> Prescription available after visit-->
<!--            </div>-->
<!--          </td>-->
<!--        </tr>-->

<!--        &lt;!&ndash; Empty state &ndash;&gt;-->
<!--        <tr th:if="${appointments == null or #lists.isEmpty(appointments)}">-->
<!--          <td colspan="7" class="px-6 py-12 text-center text-gray-500">-->
<!--            <i class="fas fa-calendar-times text-4xl mb-4 text-gray-300"></i>-->
<!--            <p class="text-lg">No appointments booked yet.</p>-->
<!--            <a href="/doctors" class="mt-4 inline-block bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">-->
<!--              Find Doctors & Book Now-->
<!--            </a>-->
<!--          </td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--      </table>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!--&lt;!&ndash; Review Modal (Tailwind-based) &ndash;&gt;-->
<!--<div id="reviewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">-->
<!--  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">-->
<!--    <div class="mt-3">-->
<!--      <h3 class="text-lg font-medium text-gray-900 mb-4">Rate Your Experience</h3>-->

<!--      &lt;!&ndash; Close Button &ndash;&gt;-->
<!--      <div class="flex justify-end mb-4">-->
<!--        <button onclick="closeReviewModal()" class="text-gray-400 hover:text-gray-600">-->
<!--          <i class="fas fa-times text-xl"></i>-->
<!--        </button>-->
<!--      </div>-->

<!--      &lt;!&ndash; Form &ndash;&gt;-->
<!--      <form id="reviewForm" th:action="@{/patients/reviews}" method="post" class="space-y-4">-->
<!--        &lt;!&ndash; Hidden Appointment ID - FIXED: No th:value, JS sets it &ndash;&gt;-->
<!--        <input type="hidden" name="appointmentId" id="appointmentId" value="">-->

<!--        &lt;!&ndash; Doctor Context &ndash;&gt;-->
<!--        <div class="bg-blue-50 p-3 rounded-lg">-->
<!--          <p class="text-sm font-medium text-blue-800" id="doctorName">Reviewing: Dr. Smith</p>-->
<!--        </div>-->

<!--        &lt;!&ndash; Star Rating &ndash;&gt;-->
<!--        <div>-->
<!--          <label class="block text-sm font-medium text-gray-700 mb-2">Your Rating (1-5 Stars)</label>-->
<!--          <div class="flex justify-center space-x-1" id="stars">-->
<!--            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="1" title="Poor"></i>-->
<!--            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="2" title="Fair"></i>-->
<!--            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="3" title="Good"></i>-->
<!--            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="4" title="Very Good"></i>-->
<!--            <i class="fas fa-star text-2xl cursor-pointer text-gray-400 hover:text-yellow-500" data-rating="5" title="Excellent"></i>-->
<!--          </div>-->
<!--          <input type="hidden" name="rating" id="ratingInput" value="0">-->
<!--          <p class="text-xs text-gray-500 mt-1 text-center">Click a star to select</p>-->
<!--        </div>-->

<!--        &lt;!&ndash; Comment &ndash;&gt;-->
<!--        <div>-->
<!--          <label for="comment" class="block text-sm font-medium text-gray-700 mb-2">Comments (Optional)</label>-->
<!--          <textarea id="comment" name="comment" rows="4"-->
<!--                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"-->
<!--                    placeholder="Share what you liked or any suggestions..."></textarea>-->
<!--        </div>-->

<!--        <div class="flex justify-end space-x-2">-->
<!--          <button type="button" onclick="closeReviewModal()"-->
<!--                  class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">-->
<!--            Cancel-->
<!--          </button>-->
<!--          <button type="submit" id="submitBtn" disabled-->
<!--                  class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50">-->
<!--            Submit Review-->
<!--          </button>-->
<!--        </div>-->
<!--      </form>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!--&lt;!&ndash; Scripts &ndash;&gt;-->
<!--<script>-->
<!--  // Define functions early (before DOM loads) to avoid "not defined" errors-->
<!--  function openReviewModal(button) {-->
<!--    console.log('openReviewModal called!');  // DEBUG: Confirms onclick fires-->
<!--    const appointmentId = button.getAttribute('data-appointment-id');-->
<!--    const doctorName = button.getAttribute('data-doctor-name');-->
<!--    console.log('Data extracted:', appointmentId, doctorName);  // DEBUG-->

<!--    if (!appointmentId || !doctorName) {-->
<!--      console.error('Missing data attrs on button');-->
<!--      alert('Error loading review data');-->
<!--      return;-->
<!--    }-->

<!--    setReviewData(appointmentId, doctorName);-->
<!--  }-->

<!--  function setReviewData(appointmentId, doctorName) {-->
<!--    console.log('setReviewData called with:', appointmentId, doctorName);  // DEBUG-->
<!--    const appointmentInput = document.getElementById('appointmentId');-->
<!--    const doctorSpan = document.getElementById('doctorName');-->
<!--    const ratingInput = document.getElementById('ratingInput');-->
<!--    const commentInput = document.getElementById('comment');-->
<!--    const submitBtn = document.getElementById('submitBtn');-->
<!--    const modal = document.getElementById('reviewModal');-->

<!--    if (!appointmentInput || !doctorSpan || !ratingInput || !commentInput || !submitBtn || !modal) {-->
<!--      console.error('Missing modal elements');-->
<!--      alert('Modal not found - refresh page');-->
<!--      return;-->
<!--    }-->

<!--    appointmentInput.value = appointmentId;-->
<!--    doctorSpan.textContent = 'Reviewing: ' + doctorName;-->
<!--    ratingInput.value = '0';-->
<!--    commentInput.value = '';-->
<!--    submitBtn.disabled = true;-->
<!--    modal.classList.remove('hidden');-->
<!--    console.log('Modal opened successfully!');  // DEBUG-->
<!--  }-->

<!--  function closeReviewModal() {-->
<!--    const modal = document.getElementById('reviewModal');-->
<!--    if (modal) modal.classList.add('hidden');-->
<!--  }-->

<!--  function highlightStars(rating, stars) {-->
<!--    stars.forEach((star, index) => {-->
<!--      if (index < rating) {-->
<!--        star.classList.remove('text-gray-400');-->
<!--        star.classList.add('text-yellow-500');-->
<!--      } else {-->
<!--        star.classList.remove('text-yellow-500');-->
<!--        star.classList.add('text-gray-400');-->
<!--      }-->
<!--    });-->
<!--  }-->

<!--  // Cancel Appointment (keep existing)-->
<!--  function cancelAppointment(appointmentId) {-->
<!--    if (!confirm('Are you sure you want to cancel this appointment?')) {-->
<!--      return;-->
<!--    }-->

<!--    fetch(`/patients/appointments/${appointmentId}/cancel`, {-->
<!--      method: 'POST',-->
<!--      headers: { 'Content-Type': 'application/json' }-->
<!--    })-->
<!--    .then(response => response.json())-->
<!--    .then(data => {-->
<!--      if (data.success) {-->
<!--        alert('Appointment cancelled successfully');-->
<!--        location.reload();-->
<!--      } else {-->
<!--        alert('Error: ' + (data.error || 'Failed to cancel'));-->
<!--      }-->
<!--    })-->
<!--    .catch(error => {-->
<!--      alert('Error cancelling appointment');-->
<!--      console.error(error);-->
<!--    });-->
<!--  }-->

<!--  // DOM Ready - Bind events-->
<!--  document.addEventListener('DOMContentLoaded', function() {-->
<!--    console.log('DOM loaded - Binding events');  // DEBUG-->
<!--    const stars = document.querySelectorAll('#stars i');-->
<!--    const ratingInput = document.getElementById('ratingInput');-->
<!--    const submitBtn = document.getElementById('submitBtn');-->
<!--    const reviewForm = document.getElementById('reviewForm');-->
<!--    const starsContainer = document.getElementById('stars');-->

<!--    if (!stars.length) {-->
<!--      console.warn('No stars found - Modal not rendered?');-->
<!--      return;-->
<!--    }-->

<!--    // Star events-->
<!--    stars.forEach(star => {-->
<!--      star.addEventListener('click', function() {-->
<!--        const rating = parseInt(this.getAttribute('data-rating'));-->
<!--        if (ratingInput) ratingInput.value = rating;-->
<!--        highlightStars(rating, stars);-->
<!--        if (submitBtn) submitBtn.disabled = false;-->
<!--        console.log('Star clicked:', rating);  // DEBUG-->
<!--      });-->

<!--      star.addEventListener('mouseover', function() {-->
<!--        const rating = parseInt(this.getAttribute('data-rating'));-->
<!--        highlightStars(rating, stars);-->
<!--      });-->
<!--    });-->

<!--    // Mouse leave reset-->
<!--    if (starsContainer) {-->
<!--      starsContainer.addEventListener('mouseleave', function() {-->
<!--        const currentRating = parseInt(ratingInput ? ratingInput.value : 0);-->
<!--        highlightStars(currentRating, stars);-->
<!--      });-->
<!--    }-->

<!--    // Form submit (AJAX for no reload)-->
<!--    if (reviewForm) {-->
<!--      reviewForm.addEventListener('submit', function(e) {-->
<!--        e.preventDefault();-->
<!--        if (ratingInput && ratingInput.value === '0') {-->
<!--          alert('Please select a rating!');-->
<!--          return;-->
<!--        }-->

<!--        const formData = new FormData();-->
<!--        formData.append('appointmentId', document.getElementById('appointmentId').value);-->
<!--        formData.append('rating', ratingInput.value);-->
<!--        formData.append('comment', document.getElementById('comment').value);-->

<!--        fetch('/patients/reviews', { method: 'POST', body: formData })-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--          if (data.success) {-->
<!--            alert('Review submitted! Thanks for your feedback.');-->
<!--            closeReviewModal();-->
<!--            location.reload();  // Reload to hide button-->
<!--          } else {-->
<!--            alert('Error: ' + (data.error || 'Submit failed'));-->
<!--          }-->
<!--        })-->
<!--        .catch(error => {-->
<!--          alert('Submission error');-->
<!--          console.error(error);-->
<!--        });-->
<!--      });-->
<!--    }-->
<!--  });-->
<!--</script>-->


<!--</body>-->
<!--</html>-->
